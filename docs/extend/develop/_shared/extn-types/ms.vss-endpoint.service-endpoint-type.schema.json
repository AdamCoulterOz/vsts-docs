{
    "$id": "ms.vss-endpoint.service-endpoint-type",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "help": "https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/serviceEndpoints.md",
    "type": "object",
    "required": [
        "name",
        "displayName",
        "authenticationSchemes"
    ],
    "definitions": {
        "inputDescriptors": {
            "type": "array",
            "description": "Endpoint type can include inputs in addition to name, URL and the auth. parameters. For example, the Azure Classic endpoint type includes inputs of: subscriptionId and subscriptionName.",
            "additionalItems": false,
            "items": {
                "name": "Connection Input",
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "description": {
                        "description": "Help text can be provided for inputs & they can include hyperlinks as well. For e.g. subscription name input of Azure Classic endpoint type has customized help.",
                        "type": "string",
                        "examples": [
                            "i18n:Subscription Name from the <a href=\"https://go.microsoft.com/fwlink/?LinkID=312990\" target=\"_blank\">publish settings file</a>"
                        ]
                    },
                    "inputMode": {
                        "type": "string",
                        "default": "textbox",
                        "description": "Text box, Text area, Combo inputs are supported. When specifying combo input, the set of possible values & default value can be provided. For example, the Azure Classic endpoint uses a combo input for environment (AzureCloud, AzureChinaCloud, AzureUSGovernment, AzureGermanCloud).",
                        "enum": [
                            "none",
                            "passwordbox",
                            "textarea",
                            "textbox",
                            "checkbox",
                            "combo",
                            "radiobuttons"
                        ]
                    },
                    "isConfidential": {
                        "type": "boolean"
                    },
                    "validation": {
                        "type": "object",
                        "properties": {
                            "isRequired": {
                                "type": "boolean"
                            },
                            "dataType": {
                                "type": "string",
                                "default": "string",
                                "enum": [
                                    "string",
                                    "number",
                                    "boolean",
                                    "guid"
                                ]
                            },
                            "maxLength": {
                                "type": "integer",
                                "enum": [
                                    300,
                                    32,
                                    100,
                                    255
                                ]
                            },
                            "maxValue": {
                                "type": "string",
                                "enum": [
                                    "65500"
                                ]
                            },
                            "minValue": {
                                "type": "string",
                                "enum": [
                                    "1"
                                ]
                            }
                        },
                        "additionalProperties": false,
                        "required": [
                            "isRequired",
                            "dataType"
                        ]
                    },
                    "values": {
                        "type": "object",
                        "properties": {
                            "inputId": {
                                "type": "string",
                                "enum": [
                                    "sslVerifyValues",
                                    "useSudoValues",
                                    "restVersionValues",
                                    "releaseUrlInput"
                                ]
                            },
                            "isDisabled": {
                                "type": "boolean"
                            },
                            "defaultValue": {
                                "type": "string",
                                "enum": [
                                    "1",
                                    "v1.0",
                                    "https://vsrm.dev.azure.com/[organization]",
                                    "",
                                    "https://index.docker.io/v1/",
                                    "https://manage.devcenter.microsoft.com",
                                    "identifier",
                                    "auto"
                                ]
                            },
                            "possibleValues": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "value": {
                                            "type": "string",
                                            "enum": [
                                                "1",
                                                "0",
                                                "v1.0",
                                                "@{value=force; displayValue=Force TLS}",
                                                "@{value=auto; displayValue=Use TLS if the server supports STARTTLS}",
                                                "@{value=ignore; displayValue=Do not use TLS, and ignore STARTTLS}",
                                                "@{value=us-west-1; displayValue=US West 1}",
                                                "@{value=eu-central-1; displayValue=EU Central 1}",
                                                "@{value=us-east-1; displayValue=US East 1 (headless)}"
                                            ]
                                        },
                                        "displayValue": {
                                            "type": "string",
                                            "enum": [
                                                "True",
                                                "False",
                                                "v1.0"
                                            ]
                                        }
                                    },
                                    "additionalProperties": false,
                                    "required": [
                                        "value",
                                        "displayValue",
                                        "defaultValue"
                                    ]
                                },
                                "additionalItems": false,
                                "required": [
                                    "inputId",
                                    "defaultValue"
                                ]
                            },
                            "isLimitedToPossibleValues": {
                                "type": "boolean"
                            }
                        },
                        "additionalProperties": false,
                        "required": [
                            "inputId",
                            "defaultValue"
                        ]
                    },
                    "helpText": {
                        "type": "string"
                    },
                    "helpMarkDown": {
                        "type": "string"
                    },
                    "defaultValue": {
                        "type": "string",
                        "enum": [
                            "AzureDevOps@dev.azure.com",
                            "Azure DevOps"
                        ]
                    }
                },
                "additionalProperties": false,
                "required": [
                    "id",
                    "name",
                    "description",
                    "inputMode",
                    "validation"
                ]
            }
        }
    },
    "properties": {
        "name": {
            "title": "Name",
            "type": "string",
            "description": "Reference name for the authentication endpoint.",
            "maxLength": 50
        },
        "displayName": {
            "title": "Display Name",
            "type": "string",
            "description": "Display name for the authentication endpoint."
        },
        "url": {
            "title": "URL",
            "type": "object",
            "description": "URL to create service connection to.",
            "properties": {
                "displayName": {
                    "name": "URL Display Name",
                    "type": "string"
                },
                "helpText": {
                    "name": "URL Help Text",
                    "type": "string"
                },
                "value": {
                    "name": "URL Value",
                    "type": "string"
                },
                "isVisible": {
                    "name": "URL Is Visible",
                    "type": "boolean"
                },
                "description": {
                    "title": "Description",
                    "type": "string"
                },
                "required": {
                    "title": "Required",
                    "type": "boolean"
                },
                "defaultValue": {
                    "title": "Default Value",
                    "type": "string"
                },
                "dependsOn": {
                    "description": "URL can be dependent on value of another input field in the endpoint type. As and when the value of the input changes, URL value will also get updated in the endpoint creation UI. For example, the Azure Classic endpoint type’s URL depends on “environment” input. A map of the “environment” input to the “URL” values is defined in the endpoint type & based on this, the value of URL gets populated.",
                    "type":"object",
                    "properties": {
                        "input": {
                            "type":"string",
                            "description": "Input field to read key value from."
                        },
                        "map":{
                            "type":"array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "key": {"type":"string",
                                    "description": "A possible value from the input field."},
                                    "value": { "type":"string","description": "URL value to return given the input field key value."}
                                }
                            }
                        }
                    }
                }
            },
            "additionalProperties": false,
            "required": [
                "displayName"
            ]
        },
        "dataSources": {
            "title": "Data Sources",
            "type": "array",
            "items": {
                "name": "Data Source",
                "type": "object",
                "properties": {
                    "name": {
                        "title": "Name",
                        "type": "string"
                    },
                    "endpointUrl": {
                        "type": "string",
                        "description": "Full URL to retrieve data from, build URL using references from other attributes inside double braces, e.g. \"{{endpoint.url}}/api/object/path\"",
                        "examples": [
                            "{{endpoint.url}}/api/object/path"
                        ]
                    },
                    "requestVerb": {
                        "name": "HTTP Request Method",
                        "type": "string",
                        "enum": [
                            "GET",
                            "POST",
                            "PUT",
                            "PATCH"
                        ]
                    },
                    "resultSelector": {
                        "name": "Response Result Selector Path",
                        "type": "string",
                        "examples": [
                            "xpath://results/items/item/name",
                            "jsonpath:$.items[*].name"
                        ],
                        "description": "Supports either an xpath or jsonpath filter on the response data."
                    },
                    "callbackContextTemplate": {
                        "type": "string",
                        "examples": [
                            "{\"table\": \"task\"}",
                            "{\"skip\": \"{{add skip 5000}}\"}",
                            "{\"skip\": \"{{add skip 1000}}\"}"
                        ]
                    },
                    "callbackRequiredTemplate": {
                        "type": "string",
                        "enum": [
                            "{{#equals table \"change_request\"}}{{isEqualNumber result.count 0}}{{else}}false{{/equals}}",
                            "{{isEqualNumber result.count 5000}}",
                            "{{isEqualNumber result.count 1000}}"
                        ]
                    },
                    "initialContextTemplate": {
                        "type": "string",
                        "enum": [
                            "{\"table\": \"change_request\"}",
                            "{\"skip\": \"0\"}"
                        ]
                    },
                    "requestContent": {
                        "type": "string"
                    },
                    "headers": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "enum": [
                                        "Content-Type"
                                    ]
                                },
                                "value": {
                                    "type": "string",
                                    "enum": [
                                        "application/x-www-form-urlencoded"
                                    ]
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "name",
                                "value"
                            ]
                        },
                        "additionalItems": false
                    },
                    "authenticationScheme":{
                        "title": "Authentication Scheme",
                        "type":"string"
                    },
                    "resourceUrl": {
                        "type":"string"
                    }
                },
                "additionalProperties": false,
                "required": [
                    "name",
                    "endpointUrl",
                    "resultSelector"
                ]
            },
            "additionalItems": false
        },
        "authenticationSchemes": {
            "type": "array",
            "title": "Authentication Schemes",
            "description": "An authentication scheme in a service endpoint determines the credentials that are used to connect to the external service. In order to populate task drop downs, Azure DevOps connects to the external service using the credentials provided as part of the endpoint. Azure DevOps effectively becomes a client of the external service querying for details pertaining to the task input. Azure DevOps supports a closed set of authentication schemes that can be utilized by a custom service endpoint type.",
            "minItems": 1,
            "items": {
                "name": "Authentication Scheme",
                "description": "A single authentication scheme object. See Authentication Schemes collection object for more details.",
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "ms.vss-endpoint.endpoint-auth-scheme-basic",
                            "ms.vss-endpoint.endpoint-auth-scheme-cert",
                            "ms.vss-endpoint.endpoint-auth-scheme-JWT",
                            "ms.vss-endpoint.endpoint-auth-scheme-none",
                            "ms.vss-endpoint.endpoint-auth-scheme-oauth2",
                            "ms.vss-endpoint.endpoint-auth-scheme-service-principal",
                            "ms.vss-endpoint.endpoint-auth-scheme-token"
                        ]
                    },
                    "headers": {
                        "type": "array",
                        "items": {
                            "name": "Header",
                            "type": "object",
                            "properties": {
                                "name": {
                                    "name": "Header Name",
                                    "type": "string",
                                    "examples": [
                                        "Authorization",
                                        "X-Date"
                                    ]
                                },
                                "value": {
                                    "type": "string",
                                    "examples": [
                                        "Basic {{ #base64 endpoint.apitoken \":\" }}",
                                        "{{ #getCurrentUTCDate {} }}"
                                    ]
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "name",
                                "value"
                            ]
                        },
                        "additionalItems": false
                    },
                    "inputDescriptors":{
                        "$ref": "#/definitions/inputDescriptors"
                    },
                    "name": {
                        "type": "string",
                        "enum": [
                            "Basic Authorization",
                            "token",
                            "Userpass"
                        ]
                    },
                    "displayName": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string",
                        "enum": [
                            "endpoint-auth-scheme-token",
                            "endpoint-auth-scheme-userpass",
                            "authentication-schema-o365"
                        ]
                    },
                    "description": {
                        "type": "string",
                        "enum": [
                            "i18n:Token based endpoint authentication scheme",
                            "i18n:Vault username endpoint authentication scheme"
                        ]
                    },
                    "authorizationUrl": {
                        "type": "string"
                    },
                    "dataSourceBindings": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "target": {
                                    "type": "string"
                                },
                                "dataSourceName": {
                                    "type": "string"
                                },
                                "resultTemplate": {
                                    "type": "string",
                                    "enum": [
                                        "{\"AccessToken\" : \"{{{access_token}}}\", \"RefreshToken\" : \"{{{refresh_token}}}\", \"ExpiresIn\" : \"{{{expires_in}}}\", \"TokenType\" : \"{{{token_type}}}\", \"Scope\" : \"{{{scope}}}\", \"Error\" : \"{{{error}}}\", \"ErrorDescription\" : \"{{{error_description}}}\"}"
                                    ]
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "target",
                                "dataSourceName",
                                "resultTemplate"
                            ]
                        },
                        "additionalItems": false
                    }
                },
                "additionalProperties": false,
                "required": [
                    "type"
                ]
            },
            "additionalItems": false
        },
        "inputDescriptors":{
            "$ref": "#/definitions/inputDescriptors"
        },
        "helpMarkDown": {
            "type": "string",
            "title": "Help Markdown Text",
            "description": "Help text including help links can be specified for the endpoint type that appears in the bottom of the create/update endpoint UI."
        },
        "icon": {
            "type": "string"
        }
    },
    "additionalProperties": false
}